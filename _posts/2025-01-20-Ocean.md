---
title: Dive into the deep secrets of rendering a realistic ocean.
background: /img/oceanIMG.png
layout: post
subtitle: Ocean Rendering
artist: Jim van der Heijden
---
# Water in modern games

<hr>
How do modern games render water, I always asked myself? In this blog post I am going to explain the deep secrets of how big studios render water in detail. There are a lot of aspects and ways to make use of water so to make it a little simpler to follow I am going to focus on oceans in specific. 

So let's start at the beginning by looking at a couple implementations of games that make great use of an ocean.

<video width="420" height="360" controls>
  <source src="/img/horizonzerodawn.mp4" type="video/mp4">
</video>
[*Horizon forbidden west swimming through a rough ocean*](https://www.youtube.com/watch?v=XT-xhCNalPc)


<video width="420" height="360" controls>
  <source src="/img/seaofthieves.mp4" type="video/mp4">
</video>
[*Sea of thieves ocean with light scattering through the waves*](https://www.youtube.com/watch?v=aGogFt4bhTM)

# The big question is how can we achieve this?

<hr>
## Setup
There are 2 major components that we need to create a realistic looking ocean the first component is an oceanographic spectra and the second component is the fast Fourier transform which I will explain later on in this post.

So what is this Oceanographic spectra? It is formula that simulates ocean waves under certain conditions, these waves are produced by different wind speeds over big areas and gravity lowers the wave amplitudes. Luckily for us we don't have to get the data from these ocean ourselves since other people did the work for us. I decided to use the [JONSWAP](https://www.codecogs.com/library/engineering/fluid_mechanics/waves/spectra/jonswap.php) (Joint North Sea Wave Project) spectrum for my implementation since it has a lot of artistical control and is based of accurate data of the north sea.

<img src="/img/Fig16-9s.jpg" alt="Image" width="400"/>
<br>*JONSWAP spectra wave amplitude at certain frequency*

Now that we have our energy spectrum function we want to randomly sample it and put all the data into a texture this is done with the formula:

$$\hat{h}_0​(k) = \frac{1}{\sqrt{2}} (\xi_r + \xi_i) \sqrt{P(k)}$$
<br>*P(k) | Wave energy spectrum of choice*
<br>*(ξr​+ξi​) | Gaussian distributed real and imaginary random numbers*

<br>We run this formula for every pixel of the texture so performance scales depending how detailed you want the waves to look, I am using a 512x512 texture since this is perfect for real-time games. The output of this will look something relatively close to this texture depending on what energy spectrum you used.

<img src="/img/initialSpectrum.png" alt="Image" width="400"/>
<br>The origin of the spectrum is in the center, the distance from the origin is the frequency, the pixels value is the amplitude and the direction from the origin to the pixel is the direction of the wave. Now that we have the frequencies we want to convert this to something visual we can do this with the Inverse Fast Fourier Transform, which converts our frequency domain texture to the time and space domain.
## IFFT
The second component we need is the fast Fourier transform which is an algorithm that efficiently computes the DFT(discrete Fourier transform). The DFT coverts
